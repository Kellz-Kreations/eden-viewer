{
    email {$CADDY_ACME_EMAIL}
    # Allow ACME HTTP-01 challenges on the default ports
}

{$PLEX_DOMAIN} {
    encode gzip zstd

    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
    }

    @legacyClients {
        header "X-Plex-Device" *
    }

    reverse_proxy 127.0.0.1:32400 {
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-Host {host}
        header_up X-Forwarded-Port {server_port}
    }
}

http://{$PLEX_DOMAIN} {
    redir https://{host}{uri} permanent
}
